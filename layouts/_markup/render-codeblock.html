{{/* prettier-ignore-start */}}
{{/*
Renders a highlighted code block using the given options and attributes.

In addition to the options available to the transform.Highlight function, you
may also specify the following parameters:

@param {bool} [copy=false] Whether to display a copy-to-clipboard button.
@param {string} [title] The title to display above the rendered code.
@param {string} [caption] The caption for the code block.

@returns {template.HTML}

@examples

    ```go
    fmt.Println("Hello world!")
    ```

    ```go {linenos=true title="layouts/index.html" copy=true}
    fmt.Println("Hello world!")
    ```
*/}}
{{/* prettier-ignore-end */}}

{{- $copy := false }}
{{- $title := or .Attributes.title "" }}
{{- $caption := or .Attributes.caption "" }}

{{- with .Attributes.copy }}
  {{- if in (slice true "true" 1) . }}
    {{- $copy = true }}
  {{- else if in (slice false "false" 0) . }}
    {{- $copy = false }}
  {{- end }}
{{- end }}

<div codeblock class="not-prose flex flex-col gap-1 my-6">
  <div class="font-mono text-base border-2 border-accent rounded-lg">
    {{- if (or $title $copy) }}
      <div class="flex gap-2 text-accent-content bg-accent px-2 py-1 rounded-t-md">
        <div class="flex-1 san-serif font-extrabold inline-block">
          {{- with $title }}
            {{ . }}
          {{- end }}
        </div>

        {{- if $copy }}
          <div class="tooltip tooltip-info">
            <svg xmlns="http://www.w3.org/2000/svg"
                codeblock-copy
                width="512"
                height="512"
                viewBox="0 0 512 512"
                class="flex-none hover:opacity-50 cursor-pointer w-6 h-6">
              <rect width="336" height="336" x="128" y="128" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" rx="57" ry="57"/>
              <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="m383.5 128l.5-24a56.16 56.16 0 0 0-56-56H112a64.19 64.19 0 0 0-64 64v216a56.16 56.16 0 0 0 56 56h24"/>
            </svg>
            <span class="tooltip-content font-sans text-lg">Copy</span>
          </div>
        {{- end }}
      </div>
    {{- end }}

    {{- $lang := or .Type "text" }}
    {{- transform.Highlight (strings.TrimSpace .Inner) $lang .Options }}
  </div>
  {{- with $caption }}
    <div class="italic font-light opacity-70 px-8">
      {{ . }}
    </div>
  {{- end }}
</div>
