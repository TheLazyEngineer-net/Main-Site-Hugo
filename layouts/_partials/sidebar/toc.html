{{- /*
  Generates the table of contents for a given page.
*/ -}}

{{- with .Fragments }}
  {{- with .Headings }}
    <ul data-pagefind-ignore="all"
        id="toc-nav"
        class="menu menu-sm">
      {{- range . }}
        {{ template "renderHeadings" . }}
      {{- end }}
    </ul>
  {{- end }}
{{- end }}

{{/* Recursive template for table of contents items */}}
{{- define "renderHeadings" }}
  {{- $minLevel := 2 }}
  {{- $maxLevel := 4 }}
  {{- $level := .Level }}
  {{- if le $level $maxLevel }}
    {{- if ge $level $minLevel }}
      <li>
        <a href="#{{ .ID }}">{{ .Title }}</a>
        {{- with .Headings }}
          {{- if (lt $level $maxLevel) }}
            <ul>
              {{- range . }}
                {{ template "renderHeadings" . }}
              {{- end }}
            </ul>
          {{- end }}
        {{- end }}
      </li>
    {{- else }}
      {{- range .Headings }}
        {{ template "renderHeadings" . }}
      {{- end }}
    {{- end }}
  {{- end }}
{{ end }}
